<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenShift Days - Ops Track</title>
    <link rel="canonical" href="http://localhost:8080/openshift-days-ops-track/main/app-mgmt-basics.html">
    <link rel="prev" href="ldap-groupsync.html">
    <link rel="next" href="networking.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank" style="margin-left: 5%;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739" style="width: 278px;"><g fill="#fff"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#fff"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#fff" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg>
      </a>
      <a class="navbar-item site-title" target="__blank" style="color: #fff !important;" href="http://localhost:8080">OpenShift Days - Ops Track</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="openshift-days-ops-track" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">OpenShift Days - Ops Track</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Environment Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 1: Platform Foundation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocp-concepts.html">OpenShift Platform Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="installation.html">Installation &amp; Verification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="oidc-authentication.html">Identity &amp; Users - OIDC</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ldap-groupsync.html">Identity &amp; Users - LDAP</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="app-mgmt-basics.html">Application Management Basics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 2: Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="networking.html">Networking &amp; Ingress</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 3: Day 2 Operations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="observability.html">Observability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="debugging-troubleshooting.html">Debugging &amp; Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="performance-tuning.html">Performance Tuning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="backup-restore.html">Backup &amp; Restore - OADP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="openshift-lightspeed.html">OpenShift Lightspeed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 4: Workloads &amp; Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualization.html">Virtualization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="acm-multicluster.html">ACM - Multi-Cluster Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="hosted-control-planes.html">Advanced Architecture - HCP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 5: Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Security - Secrets, Certs &amp; ACS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Phase 6: Platform Engineering</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cloud-infrastructure.html">Cloud Integration &amp; Infrastructure</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-hub.html">Developer Hub</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenShift Days - Ops Track</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Days - Ops Track</a></li>
    <li>Phase 1: Platform Foundation</li>
    <li><a href="app-mgmt-basics.html">Application Management Basics</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_application_management_basics"><a class="anchor" href="#_application_management_basics"></a>Application Management Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this module, you will deploy a sample application using the <code>oc</code> tool and
learn about some of the core concepts, fundamental objects, and basics of
application management on OpenShift Container Platform.</p>
</div>
<div class="sect2">
<h3 id="_core_openshift_concepts"><a class="anchor" href="#_core_openshift_concepts"></a>Core OpenShift Concepts</h3>
<div class="paragraph">
<p>As a future administrator of OpenShift, it is important to understand several
core building blocks as it relates to applications. Understanding these building
blocks will help you better see the big picture of application management on the
platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_projects"><a class="anchor" href="#_projects"></a>Projects</h3>
<div class="paragraph">
<p>A <strong>Project</strong> is a "bucket" of sorts. It&#8217;s a meta construct where all of a
user&#8217;s resources live. From an administrative perspective, each <strong>Project</strong> can
be thought of like a tenant. <strong>Projects</strong> may have multiple users who can
access them, and users may be able to access multiple <strong>Projects</strong>. Technically
speaking, a user doesn&#8217;t own the resources, the <strong>Project</strong> does. Deleting the
user doesn&#8217;t affect any of the created resources.</p>
</div>
<div class="paragraph">
<p>For this exercise, first create a <strong>Project</strong> to hold some resources:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project app-management</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_a_sample_application"><a class="anchor" href="#_deploy_a_sample_application"></a>Deploy a Sample Application</h3>
<div class="paragraph">
<p>The <code>new-app</code> command provides a very simple way to tell OpenShift to run
things. You simply provide it with one of a wide array of inputs, and it figures
out what to do. Users will commonly use this command to get OpenShift to launch
existing images, to create builds of source code and ultimately deploy them, to
instantiate templates, and so on.</p>
</div>
<div class="paragraph">
<p>You will now launch a specific image that exists on Quay</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-app quay.io/openshift-workshop-applications/weathernow:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--&gt; Found container image 6dbcf6a (5 minutes old) from quay.io for "quay.io/openshift-workshop-applications/weathernow:latest"

    * An image stream tag will be created as "weathernow:latest" that will track this image

--&gt; Creating resources ...
    imagestream.image.openshift.io "weathernow" created
    deployment.apps "weathernow" created
    service "weathernow" created
--&gt; Success
    Application is not exposed. You can expose services to the outside world by executing one or more of the commands below:
     'oc expose service/weathernow'
    Run 'oc status' to view your app.</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that OpenShift automatically created several resources as the output
of this command. We will take some time to explore the resources that were
created.</p>
</div>
<div class="paragraph">
<p>For more information on the capabilities of <code>new-app</code>, take a look at its help
message by running <code>oc new-app -h</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pods"><a class="anchor" href="#_pods"></a>Pods</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_pod_new.png" alt="openshift pod new">
</div>
<div class="title">Figure 1. OpenShift Pods</div>
</div>
<div class="paragraph">
<p>Pods are one or more containers deployed together on a host. A pod is the
smallest compute unit you can define, deploy and manage in OpenShift. Each pod is allocated
its own internal IP address on the SDN and owns the entire port range. The
containers within pods can share local storage space and networking resources.</p>
</div>
<div class="paragraph">
<p>Pods are treated as <strong>static</strong> objects by OpenShift, i.e., one cannot change the
pod definition while running.</p>
</div>
<div class="paragraph">
<p>You can get a list of pods:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
weathernow-764c5bf8b8-l49z7   1/1     Running   0          2m53s</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pod names are dynamically generated as part of the deployment process,
which you will learn about shortly. Your name will be slightly different.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>describe</code> command will give you more information on the details of a pod.
In the case of the pod name above:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe pod -l deployment=weathernow</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>-l deployment=weathernow</code> selects the pod that is related to the
<code>Deployment</code> which will be discussed later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And you will see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:             weathernow-85ddc7b8f-6kf4b
Namespace:        app-management
Priority:         0
Service Account:  default
Node:             ip-10-0-20-193.us-east-2.compute.internal/10.0.20.193
Start Time:       Fri, 05 Jul 2024 13:36:23 +0000
Labels:           deployment=weathernow
                  pod-template-hash=85ddc7b8f
Annotations:      k8s.ovn.org/pod-networks:
                    {"default":{"ip_addresses":["10.128.2.75/23"],"mac_address":"0a:58:0a:80:02:4b","gateway_ips":
["10.128.2.1"],"routes":[{"dest":"10.128.0.0...
                  k8s.v1.cni.cncf.io/network-status:
                    [{
                        "name": "ovn-kubernetes",
                        "interface": "eth0",
                        "ips": [
                            "10.128.2.75"
                        ],
                        "mac": "0a:58:0a:80:02:4b",
                        "default": true,
                        "dns": {}
                    }]
                  openshift.io/generated-by: OpenShiftNewApp
                  openshift.io/scc: restricted-v2
                  seccomp.security.alpha.kubernetes.io/pod: runtime/default
Status:           Running
SeccompProfile:   RuntimeDefault
IP:               10.128.2.75
IPs:
  IP:           10.128.2.75
Controlled By:  ReplicaSet/weathernow-85ddc7b8f
Containers:
  weathernow:
    Container ID:   cri-o://6ac58477bc41b7428da44b8a4504384faa2cd772740ca21c963a1fa5c4578f65
    Image:          quay.io/openshiftroadshow/weathernow@sha256:1366b430c7d4bddf35c7b2d067bc24e8d67ba297dbaacd10e0d8093
9efd1de9d
    Image ID:       quay.io/openshiftroadshow/weathernow@sha256:1366b430c7d4bddf35c7b2d067bc24e8d67ba297dbaacd10e0d8093
9efd1de9d
    Ports:          8080/TCP, 8778/TCP, 9779/TCP
    Host Ports:     0/TCP, 0/TCP, 0/TCP
    State:          Running
      Started:      Fri, 05 Jul 2024 13:36:30 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-79472 (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  kube-api-access-79472:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       &lt;nil&gt;
    DownwardAPI:             true
    ConfigMapName:           openshift-service-ca.crt
    ConfigMapOptional:       &lt;nil&gt;
QoS Class:                   BestEffort
Node-Selectors:              &lt;none&gt;
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason          Age   From               Message
  ----    ------          ----  ----               -------
  Normal  Scheduled       38s   default-scheduler  Successfully assigned app-management/weathernow-85ddc7b8f-6kf4b to i
p-10-0-20-193.us-east-2.compute.internal
  Normal  AddedInterface  38s   multus             Add eth0 [10.128.2.75/23] from ovn-kubernetes
  Normal  Pulling         38s   kubelet            Pulling image "quay.io/openshiftroadshow/weathernow@sha256:1366b430c
7d4bddf35c7b2d067bc24e8d67ba297dbaacd10e0d80939efd1de9d"
  Normal  Pulled          32s   kubelet            Successfully pulled image "quay.io/openshiftroadshow/weathernow@sha2
56:1366b430c7d4bddf35c7b2d067bc24e8d67ba297dbaacd10e0d80939efd1de9d" in 5.976s (5.976s including waiting)
  Normal  Created         32s   kubelet            Created container weathernow
  Normal  Started         32s   kubelet            Started container weathernow</pre>
</div>
</div>
<div class="paragraph">
<p>This is a more detailed description of the pod that is running. You can see what
node the pod is running on, the internal IP address of the pod, various labels,
and other information about what is going on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_services"><a class="anchor" href="#_services"></a>Services</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_service_new.png" alt="openshift service new">
</div>
<div class="title">Figure 2. OpenShift Service</div>
</div>
<div class="paragraph">
<p><strong>Services</strong> provide a convenient abstraction layer inside OpenShift to find a
group of like <strong>Pods</strong>. They also act as an internal proxy/load balancer between
those <strong>Pods</strong> and anything else that needs to access them from inside the
OpenShift environment. For example, if you needed more <code>weathernow</code> instances to
handle the load, you could spin up more <strong>Pods</strong>. OpenShift automatically maps
them as endpoints to the <strong>Service</strong>, and the incoming requests would not notice
anything different except that the <strong>Service</strong> was now doing a better job handling
the requests.</p>
</div>
<div class="paragraph">
<p>When you asked OpenShift to run the image, the <code>new-app</code> command
automatically created a <strong>Service</strong> for you. Remember that services are an
internal construct. They are not available to the "outside world", or
anything that is outside the OpenShift environment. That&#8217;s OK, as you will
learn later.</p>
</div>
<div class="paragraph">
<p>The way that a <strong>Service</strong> maps to a set of <strong>Pods</strong> is via a system of <strong>Labels</strong> and
<strong>Selectors</strong>. <strong>Services</strong> are assigned a fixed IP address and many ports and
protocols can be mapped.</p>
</div>
<div class="paragraph">
<p>There is a lot more information about
<a href="https://docs.openshift.com/container-platform/4.16/architecture/understanding-development.html#understanding-kubernetes-pods">Services</a>,
including the YAML format to make one by hand, in the official documentation.</p>
</div>
<div class="paragraph">
<p>You can see the current list of services in a project with:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get services</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
weathernow   ClusterIP   172.30.239.63   &lt;none&gt;        8080/TCP,8778/TCP,9779/TCP   2m35s</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Service IP addresses are dynamically assigned on creation and are
immutable. The IP of a service will never change, and the IP is reserved until
the service is deleted. Your service IP will likely be different.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just like with pods, you can <code>describe</code> services, too. In fact, you can
<code>describe</code> most objects in OpenShift:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe service weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:              weathernow
Namespace:         app-management
Labels:            app=weathernow
                   app.kubernetes.io/component=weathernow
                   app.kubernetes.io/instance=weathernow
Annotations:       openshift.io/generated-by: OpenShiftNewApp
Selector:          deployment=weathernow
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                172.30.203.181
IPs:               172.30.203.181
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.128.2.75:8080
Port:              8778-tcp  8778/TCP
TargetPort:        8778/TCP
Endpoints:         10.128.2.75:8778
Port:              9779-tcp  9779/TCP
TargetPort:        9779/TCP
Endpoints:         10.128.2.75:9779
Session Affinity:  None
Events:            &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Information about all objects (their definition, their state, and so forth) is
stored in the etcd datastore. etcd stores data as key/value pairs, and all of
this data can be represented as serializable data objects (JSON, YAML).</p>
</div>
<div class="paragraph">
<p>Take a look at the YAML output for the service:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get service weathernow -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Service
metadata:
  annotations:
    openshift.io/generated-by: OpenShiftNewApp
  creationTimestamp: "2024-07-05T13:36:23Z"
  labels:
    app: weathernow
    app.kubernetes.io/component: weathernow
    app.kubernetes.io/instance: weathernow
  name: weathernow
  namespace: app-management
  resourceVersion: "122841"
  uid: 9f4b742b-cb10-472f-8e44-547c1fbdd490
spec:
  clusterIP: 172.30.203.181
  clusterIPs:
  - 172.30.203.181
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: 8080-tcp
    port: 8080
    protocol: TCP
    targetPort: 8080
  - name: 8778-tcp
    port: 8778
    protocol: TCP
    targetPort: 8778
  - name: 9779-tcp
    port: 9779
    protocol: TCP
    targetPort: 9779
  selector:
    deployment: weathernow
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}</pre>
</div>
</div>
<div class="paragraph">
<p>Take note of the <code>selector</code> stanza. Remember it.</p>
</div>
<div class="paragraph">
<p>It is also of interest to view the YAML of the <strong>Pod</strong> to understand how OpenShift
wires components together. Go back and find the name of your <code>weathernow</code> <strong>Pod</strong>, and
then execute the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pod -l deployment=weathernow -o jsonpath='{.items[*].metadata.labels}' | jq -r</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>-o jsonpath</code> selects a specific field. In this case we are asking
for the <code>labels</code> section in the manifest.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output should look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "deployment": "weathernow",
  "pod-template-hash": "764c5bf8b8"
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Service</strong> has a <code>selector</code> stanza that refers to <code>deployment: weathernow</code>.</p>
</li>
<li>
<p>The <strong>Pod</strong> has multiple <strong>Labels</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><code>deployment: weathernow</code></p>
</li>
<li>
<p><code>pod-template-hash: 764c5bf8b8</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Labels</strong> are just key/value pairs. Any <strong>Pod</strong> in this <strong>Project</strong> that has a <strong>Label</strong> that
matches the <strong>Selector</strong> will be associated with the <strong>Service</strong>. If you look at the
<code>describe</code> output again, you will see that there is one endpoint for the
service: the existing <code>weathernow</code> <strong>Pod</strong>.</p>
</div>
<div class="paragraph">
<p>The default behavior of <code>new-app</code> is to create just one instance of the item
requested. We will see how to modify/adjust this in a moment, but there are a
few more concepts to learn first.</p>
</div>
</div>
<div class="sect2">
<h3 id="_background_deployments_and_replicasets_in_openshift"><a class="anchor" href="#_background_deployments_and_replicasets_in_openshift"></a>Background: Deployments and ReplicaSets in OpenShift</h3>
<div class="paragraph">
<p>While <strong>Services</strong> provide routing and load balancing for <strong>Pods</strong>, which may go in
and out of existence, <strong>ReplicaSets</strong> (RS) are used to specify and then
ensure the desired number of <strong>Pods</strong> (replicas) are in existence. For example, if
you always want an application to be scaled to 3 <strong>Pods</strong> (instances), a
<strong>ReplicaSet</strong> is needed. Without an RS, any <strong>Pods</strong> that are killed or
somehow die/exit are not automatically restarted. <strong>ReplicaSets</strong> are
how OpenShift "self heals".</p>
</div>
<div class="paragraph">
<p>A <strong>Deployment</strong> (deploy) defines how something in OpenShift should be
deployed. From the <a href="https://docs.openshift.com/container-platform/4.16/applications/deployments/what-deployments-are.html#deployments-kube-deployments_what-deployments-are">deployments documentation</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deployments describe the desired state of a particular component of an
application as a Pod template. Deployments create ReplicaSets, which
orchestrate Pod lifecycles.</pre>
</div>
</div>
<div class="paragraph">
<p>In almost all cases, you will end up using the <strong>Pod</strong>, <strong>Service</strong>,
<strong>ReplicaSet</strong> and <strong>Deployment</strong> resources together. And, in
almost all of those cases, OpenShift will create all of them for you.</p>
</div>
<div class="paragraph">
<p>There are some edge cases where you might want some <strong>Pods</strong> and an <strong>RS</strong> without a <strong>Deployments</strong>
or a <strong>Service</strong>, and others, but these are advanced topics not covered in these
exercises.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Earlier versions of OpenShift used something called a <strong>DeploymentConfig</strong>.
While still a valid deployment mechanism, moving forward the <strong>Deployment</strong> will
be what will be created with <code>oc new-app</code>. See the
<a href="https://docs.openshift.com/container-platform/4.16/applications/deployments/what-deployments-are.html#deployments-comparing-deploymentconfigs_what-deployments-are">official
documentation</a> for more details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exploring_deployment_related_objects"><a class="anchor" href="#_exploring_deployment_related_objects"></a>Exploring Deployment-related Objects</h3>
<div class="paragraph">
<p>Now that we know the background of what a <strong>ReplicaSet</strong> and
<strong>Deployment</strong> are, we can explore how they work and are related. Take a
look at the <strong>Deployment</strong> (deploy) that was created for you when you told
OpenShift to stand up the <code>weathernow</code> image:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get deployment</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
weathernow   1/1     1            1           76m</pre>
</div>
</div>
<div class="paragraph">
<p>you can also shorten the command to <code>oc get deploy</code>.</p>
</div>
<div class="paragraph">
<p>To get more details, we can look into the <strong>ReplicaSet</strong> (<strong>RS</strong>).</p>
</div>
<div class="paragraph">
<p>Take a look at the <strong>ReplicaSet</strong> (RS) that was created for you when
you told OpenShift to stand up the <code>weathernow</code> image:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get replicaset</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
weathernow-7bf4f447ff   0         0         0       18m
weathernow-85fdb44576   1         1         1       18m</pre>
</div>
</div>
<div class="paragraph">
<p>you can also shorten the command to <code>oc get rs</code>.</p>
</div>
<div class="paragraph">
<p>This lets us know that, right now, we expect one <strong>Pod</strong> to be deployed
(<code>Desired</code>), and we have one <strong>Pod</strong> actually deployed (<code>Current</code>). By changing
the desired number, we can tell OpenShift that we want more or less <strong>Pods</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_the_application"><a class="anchor" href="#_scaling_the_application"></a>Scaling the Application</h3>
<div class="paragraph">
<p>Let&#8217;s scale our weathernow "application" up to 2 instances. We can do this with
the <code>scale</code> command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc scale --replicas=2 deploy/weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify that we changed the number of replicas, issue the following command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get replicaset</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
weathernow-764c5bf8b8   2         2         2       79m
weathernow-8695cb9c67   0         0         0       79m</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "older" version was kept. This is to we can "rollback" to a previous
version of the application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can see that we now have 2 replicas. Let&#8217;s verify the number of pods with
the <code>oc get pods</code> command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
weathernow-764c5bf8b8-b4vpn   1/1     Running   0          112s
weathernow-764c5bf8b8-l49z7   1/1     Running   0          81m</pre>
</div>
</div>
<div class="paragraph">
<p>And lastly, let&#8217;s verify that the <strong>Service</strong> that we learned about in the
previous lab accurately reflects two endpoints:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe service weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can also shorten the command to <code>oc describe svc weathernow</code>.</p>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:              weathernow
Namespace:         app-management
Labels:            app=weathernow
                   app.kubernetes.io/component=weathernow
                   app.kubernetes.io/instance=weathernow
Annotations:       openshift.io/generated-by: OpenShiftNewApp
Selector:          deployment=weathernow
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                172.30.203.181
IPs:               172.30.203.181
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.128.2.75:8080,10.131.0.124:8080
Port:              8778-tcp  8778/TCP
TargetPort:        8778/TCP
Endpoints:         10.128.2.75:8778,10.131.0.124:8778
Port:              9779-tcp  9779/TCP
TargetPort:        9779/TCP
Endpoints:         10.128.2.75:9779,10.131.0.124:9779
Session Affinity:  None
Events:            &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Another way to look at a <strong>Service</strong>'s endpoints is with the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get endpoints weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    ENDPOINTS                                                        AGE
weathernow   10.128.2.94:8080,10.131.0.99:8080,10.128.2.94:9779 + 3 more...   4m32s</pre>
</div>
</div>
<div class="paragraph">
<p>Your IP addresses will likely be different, as each pod receives a unique IP
within the OpenShift environment. The endpoint list is a quick way to see how
many pods are behind a service.</p>
</div>
<div class="paragraph">
<p>Overall, that&#8217;s how simple it is to scale an application (<strong>Pods</strong> in a
<strong>Service</strong>). Application scaling can happen extremely quickly because OpenShift
is just launching new instances of an existing image, especially if that image
is already cached on the node.</p>
</div>
<div class="paragraph">
<p>One last thing to note is that there are actually several ports defined on this
<strong>Service</strong>. Earlier we said that a pod gets a single IP and has control of the
entire port space on that IP. While something running inside the <strong>Pod</strong> may listen
on multiple ports (single container using multiple ports, individual containers
using individual ports, a mix), a <strong>Service</strong> can actually proxy/map ports to
different places.</p>
</div>
<div class="paragraph">
<p>For example, a <strong>Service</strong> could listen on port 80 (for legacy reasons) but the
<strong>Pod</strong> could be listening on port 8080, 8888, or anything else.</p>
</div>
<div class="paragraph">
<p>In this <code>weathernow</code> case, the image we ran has several <code>EXPOSE</code> statements in the
<code>Dockerfile</code>, so OpenShift automatically created ports on the service and mapped
them into the <strong>Pods</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_self_healing"><a class="anchor" href="#_application_self_healing"></a>Application "Self Healing"</h3>
<div class="paragraph">
<p>Because OpenShift&#8217;s <strong>RSs</strong> are constantly monitoring to see that the desired number
of <strong>Pods</strong> are actually running, you might also expect that OpenShift will "fix" the
situation if it is ever not right. You would be correct!</p>
</div>
<div class="paragraph">
<p>Now that we have two <strong>Pods</strong> running right now, let&#8217;s see what happens when we
delete them. Frist, run the <code>oc get pods</code> command, and make note of the <strong>Pod</strong>
names:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
weathernow-764c5bf8b8-lxnvw   1/1     Running   0          2m28s
weathernow-764c5bf8b8-rscss   1/1     Running   0          2m54s</pre>
</div>
</div>
<div class="paragraph">
<p>Now, delete the pods that belong to the <strong>Deployment</strong> <code>weathernow</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete pods -l deployment=weathernow --wait=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>oc get pods</code> command once again:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>Did you notice anything? There are new containers already running!</p>
</div>
<div class="paragraph">
<p>The <strong>Pods</strong> has a different name. That&#8217;s because OpenShift almost immediately
detected that the current state (0 <strong>Pods</strong>, because they were deleted) didn&#8217;t
match the desired state (2 <strong>Pods</strong>), and it
fixed it by scheduling the <strong>Pods</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_background_routes"><a class="anchor" href="#_background_routes"></a>Background: Routes</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_route_new.png" alt="openshift route new">
</div>
<div class="title">Figure 3. OpenShift Route</div>
</div>
<div class="paragraph">
<p>While <strong>Services</strong> provide internal abstraction and load balancing within an
OpenShift environment, sometimes clients (users, systems, devices, etc.)
<strong>outside</strong> of OpenShift need to access an application. The way that external
clients are able to access applications running in OpenShift is through the
OpenShift routing layer. And the data object behind that is a <strong>Route</strong>.</p>
</div>
<div class="paragraph">
<p>The default OpenShift router (HAProxy) uses the HTTP header of the incoming
request to determine where to proxy the connection. You can optionally define
security, such as TLS, for the <strong>Route</strong>. If you want your <strong>Services</strong> (and by
extension, your <strong>Pods</strong>) to be accessible to the outside world, then you need to
create a <strong>Route</strong>.</p>
</div>
<div class="paragraph">
<p>Do you remember setting up the router? You probably don&#8217;t. That&#8217;s because the
installation deployed an Operator for the router, and the operator created a
router for you! The router lives in the <code>openshift-ingress</code>
<strong>Project</strong>, and you can see information about it with the following command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe deployment router-default -n openshift-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will explore the Operator for the router more in a subsequent exercise.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_route"><a class="anchor" href="#_creating_a_route"></a>Creating a Route</h3>
<div class="paragraph">
<p>Creating a <strong>Route</strong> is a pretty straight-forward process. We will create a
secure HTTPS route. If you remember from earlier, your <strong>Service</strong> name is
<code>weathernow</code>. With the <strong>Service</strong> name, creating a secure <strong>Route</strong> is a simple
one-command task:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create route edge weathernow --service=weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>route.route.openshift.io/weathernow created</pre>
</div>
</div>
<div class="paragraph">
<p>Verify the <strong>Route</strong> was created with the following command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME         HOST/PORT                                             PATH   SERVICES     PORT       TERMINATION   WILDCARD
weathernow   weathernow-app-management.{route_subdomain}              weathernow   8080-tcp   edge          None</pre>
</div>
</div>
<div class="paragraph">
<p>If you take a look at the <code>HOST/PORT</code> column, you&#8217;ll see a familiar looking
FQDN. The default behavior of OpenShift is to expose services on a formulaic
hostname:</p>
</div>
<div class="paragraph">
<p><code>{SERVICENAME}-{PROJECTNAME}.{ROUTINGSUBDOMAIN}</code></p>
</div>
<div class="paragraph">
<p>In the subsequent router Operator labs we&#8217;ll explore this and other
configuration options.</p>
</div>
<div class="paragraph">
<p>While the router configuration specifies the domain(s) that the router should
listen for, something still needs to get requests for those domains to the
Router in the first place. There is a wildcard DNS entry that points
<code>*.apps...</code> to the host where the router lives. OpenShift concatenates the
<strong>Service</strong> name, <strong>Project</strong> name, and the routing subdomain to create this
FQDN/URL.</p>
</div>
<div class="paragraph">
<p>You can visit this URL using your browser, or using <code>curl</code>, or any other tool.
It should be accessible from anywhere on the internet.</p>
</div>
<div class="paragraph">
<p>The <strong>Route</strong> is associated with the <strong>Service</strong>, and the router automatically
proxies connections directly to the <strong>Pod</strong>. The router itself runs as a <strong>Pod</strong>. It
bridges the "real" internet to the SDN.</p>
</div>
<div class="paragraph">
<p>If you take a step back to examine everything you&#8217;ve done so far, in three
commands you deployed an application, scaled it, and made it accessible to the
outside world:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-app quay.io/openshift-workshop-applications/weathernow:latest
oc scale --replicas=2 deploy/weathernow
oc create route edge weathernow --service=weathernow</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scale_down"><a class="anchor" href="#_scale_down"></a>Scale Down</h3>
<div class="paragraph">
<p>Before we continue, go ahead and scale your application down to a single
instance:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc scale --replicas=1 deploy/weathernow</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_probes"><a class="anchor" href="#_application_probes"></a>Application Probes</h3>
<div class="paragraph">
<p>OpenShift provides rudimentary capabilities around checking the liveness and/or
readiness of application instances. If the basic checks are insufficient,
OpenShift also allows you to run a command inside the <strong>Pod</strong>/container in order
to perform the check. That command could be a complicated script that uses any
language already installed inside the container image.</p>
</div>
<div class="paragraph">
<p>There are three types of application probes that can be defined:</p>
</div>
<div class="paragraph">
<p><strong>Liveness Probe</strong></p>
</div>
<div class="paragraph">
<p>A liveness probe checks if the container in which it is configured is still
running. If the liveness probe fails, the container is killed, which will be
subjected to its restart policy.</p>
</div>
<div class="paragraph">
<p><strong>Readiness Probe</strong></p>
</div>
<div class="paragraph">
<p>A readiness probe determines if a container is ready to service requests. If the
readiness probe fails, the endpoint&#8217;s controller ensures the container has its IP
address removed from the endpoints of all services that should match it. A
readiness probe can be used to signal to the endpoint&#8217;s controller that even
though a container is running, it should not receive any traffic.</p>
</div>
<div class="paragraph">
<p><strong>Startup Probe</strong></p>
</div>
<div class="paragraph">
<p>A startup probe indicates whether the application within a container is started.
All other probes are disabled until the startup succeeds. If the startup probe
does not succeed within a specified time period, the kubelet kills the container,
and the container is subject to the pod restartPolicy.</p>
</div>
<div class="paragraph">
<p>More information on probing applications is available in the
<a href="https://docs.openshift.com/container-platform/4.16/applications/application-health.html">Application
Health</a> section of the documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_probes_to_the_application"><a class="anchor" href="#_add_probes_to_the_application"></a>Add Probes to the Application</h3>
<div class="paragraph">
<p>The <code>oc set</code> command can be used to perform several different functions, one of
which is creating and/or modifying probes. The <code>weathernow</code> application exposes an
endpoint which we can check to see if it is alive and ready to respond. You can
test it using <code>curl</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl https://weathernow-app-management.{route_subdomain}/health</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will get some JSON as a response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"checks":1,"pod":"weathernow-76cd968975-bv4rk","status":"UP"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask OpenShift to probe this endpoint for liveness with the following
command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc set probe deploy/weathernow --liveness --get-url=http://:8080/health --initial-delay-seconds=30</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then see that this probe is defined in the <code>oc describe</code> output:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe deployment weathernow</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see a section like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
  Containers:
   weathernow:
    Image:        quay.io/openshift-workshop-applications/weathernow@sha256:362b6db3baa0c17704ff670ecea1eb15054288750c62e91f1b683502f5ac7757
    Ports:        8080/TCP
    Host Ports:   0/TCP
    Liveness:     http-get http://:8080/health delay=30s timeout=1s period=10s #success=1 #failure=3
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
...</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can set a readiness probe in the same manner:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc set probe deploy/weathernow --readiness --get-url=http://:8080/health --initial-delay-seconds=30</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examining_deployments_and_replicasets"><a class="anchor" href="#_examining_deployments_and_replicasets"></a>Examining Deployments and ReplicaSets</h3>
<div class="paragraph">
<p>Each change to the <strong>Deployment</strong> is counted as a <em>configuration</em> change, which
<em>triggers</em> a new <em>deployment</em>. The <strong>Deployment</strong> is in charge of which
<strong>ReplicaSet</strong> to deploy. The <em>newest</em> is always deployed.</p>
</div>
<div class="paragraph">
<p>Execute the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
weathernow   1/1     1            1           131m</pre>
</div>
</div>
<div class="paragraph">
<p>You made two material configuration changes (plus a scale), after the initial deployment,
thus you are now on the fourth revision of the <strong>Deployment</strong>.</p>
</div>
<div class="paragraph">
<p>Execute the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get replicasets</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
weathernow-5f695ff4b8   1         1         1       4m19s
weathernow-668f69cdd5   0         0         0       6m18s
weathernow-764c5bf8b8   0         0         0       133m
weathernow-8695cb9c67   0         0         0       133m</pre>
</div>
</div>
<div class="paragraph">
<p>Each time a new deployment is triggered, the deployer pod creates a new
<strong>ReplicaSet</strong> which then is responsible for ensuring that pods
exist. Notice that the old RSs have a desired scale of zero, and the most
recent RS has a desired scale of 1.</p>
</div>
<div class="paragraph">
<p>If you <code>oc describe</code> each of these RSs you will see how earlier versions have
no probes, and the latest running RS has the new probes.</p>
</div>
<div class="paragraph">
<p>Feel free to try out the weathernow application:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route weathernow -o jsonpath='{.spec.host}' | sed 's/^/https:\/\//'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application should now be accessible via the route. You can test it with curl or visit it in your browser to see the weather lookup interface.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="ldap-groupsync.html" class="query-params-link">Identity &amp; Users - LDAP</a></span>
  <span class="next"><a href="networking.html" class="query-params-link">Networking &amp; Ingress</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
