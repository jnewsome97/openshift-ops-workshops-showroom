= Debugging - 10 Common Issues

[NOTE]
====
**Module Status:** NEW CONTENT REQUIRED (Can be curated from existing content)

This module needs to be created for the OpenShift Days 101 Ops Track.
Target version: OCP 4.20+
====

== Module Overview

**Duration:** 25-30 minutes +
**Format:** Hands-on troubleshooting exercises +
**Audience:** IT Operations, Infrastructure Specialists

== Learning Objectives

By the end of this module, participants will be able to:

* Recognize the 10 most common OpenShift issues
* Use CLI and Console to diagnose problems
* Apply quick fixes for common scenarios
* Know when to escalate to support

== Content Outline

=== Introduction: The Troubleshooting Mindset (3 mins)

**The 3-Step Approach:**
1. **Observe** - What's the actual symptom?
2. **Investigate** - Where is the problem?
3. **Remediate** - Fix or escalate

**Key Tools:**
* `oc get` - Status of resources
* `oc describe` - Detailed info + events
* `oc logs` - Application and pod logs
* Web Console - Visual debugging

---

=== Issue #1: CrashLoopBackOff (5 mins)

==== Symptom
Pod constantly restarts, never becomes Ready.

==== Investigation
[source,bash,role="execute"]
----
oc get pods
# Shows: STATUS = CrashLoopBackOff

oc describe pod <pod-name>
# Check Events section for exit code
----

==== Common Causes
* Application code error (exit code 1)
* Missing configuration (environment variable, config map)
* Failing liveness probe

==== Remediation
[source,bash,role="execute"]
----
# Check logs for crash reason
oc logs <pod-name>

# Check previous crashed container
oc logs <pod-name> --previous
----

**Fix examples:**
* Add missing environment variable
* Fix application code
* Adjust liveness probe timing

---

=== Issue #2: ImagePullBackOff (4 mins)

==== Symptom
Pod stuck in "Pending" or "ImagePullBackOff" status.

==== Investigation
[source,bash,role="execute"]
----
oc describe pod <pod-name>
# Look for: "Failed to pull image"
----

==== Common Causes
* Image name typo
* Missing pull secret for private registry
* Image doesn't exist

==== Remediation
[source,bash,role="execute"]
----
# Verify image exists
podman pull <image-name>

# Check pull secrets
oc get secrets | grep registry

# Link pull secret to service account
oc secrets link default <pull-secret-name> --for=pull
----

---

=== Issue #3: Pending Pods (No Available Nodes) (4 mins)

==== Symptom
Pod stuck in "Pending" status indefinitely.

==== Investigation
[source,bash,role="execute"]
----
oc describe pod <pod-name>
# Events: "0/5 nodes are available: insufficient memory"
----

==== Common Causes
* Resource requests exceed available capacity
* Node selector doesn't match any nodes
* Taints prevent scheduling

==== Remediation
[source,bash,role="execute"]
----
# Check node capacity
oc describe nodes

# Check if requests are too high
oc get pod <pod-name> -o yaml | grep -A5 resources

# Scale up workers (if using MachineSet)
oc scale machineset <machineset-name> --replicas=3
----

---

=== Issue #4: Service Not Accessible (5 mins)

==== Symptom
Can't reach application via Route or Service.

==== Investigation (Layered Approach)

**Layer 1: Is the Pod running?**
[source,bash,role="execute"]
----
oc get pods
----

**Layer 2: Is the Service pointing to the Pod?**
[source,bash,role="execute"]
----
oc get svc <service-name> -o yaml
# Check selector matches pod labels

oc get endpoints <service-name>
# Should show pod IPs
----

**Layer 3: Is the Route configured?**
[source,bash,role="execute"]
----
oc get route <route-name>
# Check host and path
----

**Layer 4: Is the application listening?**
[source,bash,role="execute"]
----
oc rsh <pod-name>
curl localhost:8080
----

==== Common Fixes
* Selector mismatch: Update Service selector
* Wrong port: Check containerPort vs Service port
* Route not created: `oc expose svc <service-name>`

---

=== Issue #5: Exceeded Quota (3 mins)

==== Symptom
Pod creation fails with quota error.

==== Investigation
[source,bash,role="execute"]
----
oc describe quota
# Shows: Used vs Hard limits
----

==== Remediation
[source,bash,role="execute"]
----
# Option 1: Increase quota (if you have permission)
oc patch resourcequota <quota-name> --patch '{"spec":{"hard":{"pods":"20"}}}'

# Option 2: Delete unused resources
oc delete pod <unused-pod>

# Option 3: Request quota increase from cluster admin
----

---

=== Issue #6: PVC Stuck in Pending (4 mins)

==== Symptom
PersistentVolumeClaim never binds to a volume.

==== Investigation
[source,bash,role="execute"]
----
oc get pvc
# STATUS: Pending

oc describe pvc <pvc-name>
# Check Events
----

==== Common Causes
* No storage class available
* No PVs with sufficient capacity
* Storage class doesn't support access mode requested

==== Remediation
[source,bash,role="execute"]
----
# Check available storage classes
oc get sc

# Check if dynamic provisioning is enabled
oc get sc <storage-class-name> -o yaml

# Verify PV availability (if using static PVs)
oc get pv
----

---

=== Issue #7: Node NotReady (4 mins)

==== Symptom
Node shows "NotReady" status.

==== Investigation
[source,bash,role="execute"]
----
oc get nodes
# STATUS: NotReady

oc describe node <node-name>
# Check Conditions section
----

==== Common Causes
* Disk pressure
* Memory pressure
* Network issues (kubelet can't reach API server)

==== Remediation
[source,bash,role="execute"]
----
# Check node logs (requires SSH or must-gather)
oc adm node-logs <node-name>

# Cordon node to prevent new pods
oc adm cordon <node-name>

# Drain node for maintenance
oc adm drain <node-name> --ignore-daemonsets --delete-emptydir-data
----

**If node is unrecoverable:**
[source,bash,role="execute"]
----
# Delete the node (if using MachineSets, a new one provisions automatically)
oc delete node <node-name>
----

---

=== Issue #8: High Memory/CPU Usage (3 mins)

==== Symptom
Application slow or OOMKilled.

==== Investigation (Console Method)
1. Navigate to **Observe â†’ Dashboards**
2. Select **Kubernetes / Compute Resources / Namespace (Pods)**
3. Select your namespace
4. Identify high-usage pods

==== Remediation
[source,bash,role="execute"]
----
# Increase resource limits
oc set resources deployment <deployment-name> \
  --limits=memory=1Gi,cpu=1

# Scale horizontally instead
oc scale deployment <deployment-name> --replicas=3
----

---

=== Issue #9: DNS Resolution Failures (3 mins)

==== Symptom
Application can't resolve service names.

==== Investigation
[source,bash,role="execute"]
----
# Test DNS from inside a pod
oc rsh <pod-name>
nslookup <service-name>

# Check DNS pods
oc get pods -n openshift-dns
----

==== Common Causes
* DNS pods crashed
* Network policy blocking DNS
* Incorrect service name (wrong namespace)

==== Remediation
[source,bash,role="execute"]
----
# Use fully qualified service name
curl http://<service-name>.<namespace>.svc.cluster.local
----

---

=== Issue #10: Cluster Upgrade Stuck (3 mins)

==== Symptom
Cluster version operator shows "Progressing" for extended time.

==== Investigation
[source,bash,role="execute"]
----
oc get clusterversion
oc describe clusterversion

# Check cluster operators
oc get co
# Look for AVAILABLE=False or DEGRADED=True
----

==== Remediation
[source,bash,role="execute"]
----
# Investigate failing operator
oc describe co <operator-name>

# Check operator pod logs
oc logs -n <operator-namespace> <operator-pod>
----

**Common blockers:**
* Node not ready
* Operator pod crashing
* Custom workload preventing node drain

---

== Summary: The Ops Toolkit (2 mins)

=== Essential Commands Cheat Sheet

[source,bash]
----
# Quick status
oc get pods,svc,routes

# Deep dive
oc describe <resource> <name>

# Logs
oc logs <pod> -f
oc logs <pod> --previous

# Events (cluster-wide)
oc get events --sort-by='.lastTimestamp'

# Resource consumption
oc adm top nodes
oc adm top pods

# Access pod
oc rsh <pod>
oc debug node/<node-name>
----

=== When to Escalate

* Hardware failures
* Cluster control plane issues
* Operator bugs
* Need to contact Red Hat Support

---

== Resources Required

* [ ] OCP cluster with intentional issues pre-created for troubleshooting
* [ ] Lab exercises with step-by-step remediation
* [ ] Cheat sheet handout (PDF)

== Lab Setup Notes

**Pre-create these scenarios:**
1. Deploy app with wrong image name (ImagePullBackOff)
2. Create pod with excessive resource request (Pending)
3. Deploy app without creating Route (Service not accessible)
4. Set low quota and deploy beyond it (Quota exceeded)

**Each student:**
* Gets namespace with broken resources
* Must diagnose and fix using CLI + Console
* Instructor provides hints if stuck

== Development Notes

**References:**
* https://docs.openshift.com/container-platform/4.20/support/troubleshooting/investigating-pod-issues.html
* https://docs.openshift.com/container-platform/4.20/support/gathering-cluster-data.html

**Key Messages:**
* Most issues have patterns
* Events are your friend
* Console + CLI = complete picture
* Know when to escalate

**Curate from existing content:**
* app-mgmt-basics.adoc has good pod troubleshooting examples
* monitoring-basics.adoc has resource usage investigation
