= OpenID Connect (OIDC) Authentication with Red Hat SSO

== Module Overview

**Duration:** 35 minutes +
**Format:** Hands-on OIDC identity provider configuration +
**Audience:** Platform Engineers, Operations Teams, Security Administrators

**Narrative Context:**

Modern organizations use OpenID Connect (OIDC) for single sign-on across applications. In this hands-on lab, you'll deploy **Red Hat Single Sign-On (based on Keycloak)** in your OpenShift cluster and integrate it with OpenShift authentication.

This demonstrates how to integrate OpenShift with enterprise OIDC providers - the same concepts apply to Azure AD, Okta, Google Workspace, and other OIDC providers.

As an operations team, you will:
- Deploy Red Hat SSO using OpenShift Operators
- Configure OIDC realms, clients, users, and groups
- Integrate OpenShift OAuth with Red Hat SSO
- Experience automatic group synchronization (vs manual LDAP sync)
- Configure RBAC with OIDC groups

== Learning Objectives

By the end of this module, you will be able to:

* Deploy Red Hat Single Sign-On using OpenShift Operators
* Configure OIDC realms and clients for OpenShift integration
* Understand OIDC authentication flows and token claims
* Configure automatic group synchronization from OIDC to OpenShift
* Compare OIDC vs LDAP authentication approaches
* Implement role-based access control with OIDC groups
* Troubleshoot OIDC integration issues

== Understanding OpenID Connect (OIDC)

**What is OIDC?**

OpenID Connect is an identity layer built on top of OAuth 2.0. It allows applications to verify user identity and obtain profile information through standardized protocols.

**OIDC vs LDAP Comparison:**

[cols="1,1,1"]
|===
|Feature |OIDC |LDAP (previous module)

|Protocol
|HTTP/REST with JSON
|LDAP protocol (port 389/636)

|Authentication
|Token-based (JWT)
|Bind with username/password

|Group sync
|**Automatic** via token claims
|**Manual** `oc adm groups sync` required

|Multi-factor auth
|Native IdP support
|Requires additional integration

|Best for
|Cloud-native, SaaS, multi-app SSO
|Traditional enterprise, on-premises

|Setup
|Client registration in provider
|Certificates, bind DN configuration
|===

**Key OIDC Advantage:** Groups automatically sync from ID token claims without manual commands!

**When to use OIDC:**
- Azure Active Directory (Microsoft 365, Azure)
- Okta (Enterprise SSO platform)
- Google Workspace
- Red Hat Single Sign-On (self-hosted)
- Modern authentication requirements (MFA, passwordless)

For complete OIDC details, see link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/authentication_and_authorization/configuring-oidc-identity-provider[Configuring an OpenID Connect identity provider].

== Step 1: Install Red Hat SSO Operator

The Red Hat SSO Operator manages Keycloak instances in OpenShift.

**Create namespace for Red Hat SSO:**

[source,bash,role="execute"]
----
oc create namespace rhsso
----

**Install the operator:**

[source,bash,role="execute"]
----
cat <<EOF | oc apply -f -
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: rhsso-operator-group
  namespace: rhsso
spec:
  targetNamespaces:
  - rhsso
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: rhsso-operator
  namespace: rhsso
spec:
  channel: stable
  installPlanApproval: Automatic
  name: rhsso-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
EOF
----

**Wait for operator installation:**

[source,bash,role="execute"]
----
oc get csv -n rhsso -w
----

Wait until you see `Succeeded` in the PHASE column (press Ctrl+C to exit).

**Verify operator is running:**

[source,bash,role="execute"]
----
oc get pods -n rhsso
----

You should see the `rhsso-operator` pod running.

== Step 2: Deploy Keycloak Instance

Now deploy a Keycloak instance using the operator.

**Create Keycloak instance:**

[source,bash,role="execute"]
----
cat <<EOF | oc apply -f -
apiVersion: keycloak.org/v1alpha1
kind: Keycloak
metadata:
  name: rhsso
  namespace: rhsso
  labels:
    app: sso
spec:
  instances: 1
  externalAccess:
    enabled: true
EOF
----

**Monitor deployment:**

[source,bash,role="execute"]
----
oc get pods -n rhsso -w
----

Wait for `keycloak-0` pod to show `1/1 Running` (this takes 2-3 minutes). Press Ctrl+C to exit.

**Verify Keycloak is running:**

[source,bash,role="execute"]
----
oc get pods -n rhsso
oc get routes -n rhsso
----

You should see `keycloak-0` in Running state and a route URL.

**Get the Keycloak admin credentials:**

[source,bash,role="execute"]
----
oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_USERNAME}' | base64 -d && echo
oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_PASSWORD}' | base64 -d && echo
----

Note these credentials - you'll use them to access the Keycloak admin console.

== Step 3: Configure Keycloak Realm for OpenShift

**Get the Keycloak route:**

[source,bash,role="execute"]
----
KEYCLOAK_URL=$(oc get route keycloak -n rhsso -o jsonpath='{.spec.host}')
echo "Keycloak URL: https://$KEYCLOAK_URL"
----

**Create an OpenShift realm:**

[source,bash,role="execute"]
----
cat <<EOF | oc apply -f -
apiVersion: keycloak.org/v1alpha1
kind: KeycloakRealm
metadata:
  name: openshift-realm
  namespace: rhsso
spec:
  instanceSelector:
    matchLabels:
      app: sso
  realm:
    id: openshift
    realm: openshift
    enabled: true
    displayName: "OpenShift Authentication"
EOF
----

**Verify realm creation:**

[source,bash,role="execute"]
----
oc get keycloakrealm -n rhsso
----

== Step 4: Create OIDC Users and Groups

**Create Keycloak users:**

[source,bash,role="execute"]
----
cat <<EOF | oc apply -f -
apiVersion: keycloak.org/v1alpha1
kind: KeycloakUser
metadata:
  name: admin1
  namespace: rhsso
spec:
  realmSelector:
    matchLabels:
      app: sso
  user:
    username: admin1
    firstName: Admin
    lastName: User
    email: admin1@example.com
    enabled: true
    credentials:
    - type: password
      value: OpenShift123!
---
apiVersion: keycloak.org/v1alpha1
kind: KeycloakUser
metadata:
  name: developer1
  namespace: rhsso
spec:
  realmSelector:
    matchLabels:
      app: sso
  user:
    username: developer1
    firstName: Developer
    lastName: User
    email: developer1@example.com
    enabled: true
    credentials:
    - type: password
      value: OpenShift123!
---
apiVersion: keycloak.org/v1alpha1
kind: KeycloakUser
metadata:
  name: viewer1
  namespace: rhsso
spec:
  realmSelector:
    matchLabels:
      app: sso
  user:
    username: viewer1
    firstName: Viewer
    lastName: User
    email: viewer1@example.com
    enabled: true
    credentials:
    - type: password
      value: OpenShift123!
EOF
----

**Note:** In production, you would federate to your organization's existing user directory (LDAP, AD, etc.) rather than creating users manually.

**Verify users created:**

[source,bash,role="execute"]
----
oc get keycloakuser -n rhsso
----

== Step 5: Configure OIDC Client for OpenShift

**Get your OpenShift API server domain:**

[source,bash,role="execute"]
----
OCP_DOMAIN=$(oc whoami --show-server | sed 's|https://api.||' | sed 's|:6443||')
echo "OpenShift domain: $OCP_DOMAIN"
OAUTH_CALLBACK="https://oauth-openshift.apps.${OCP_DOMAIN}/oauth2callback/rhsso"
echo "OAuth callback URL: $OAUTH_CALLBACK"
----

**Create OIDC client for OpenShift:**

[source,bash,role="execute"]
----
cat <<EOF | oc apply -f -
apiVersion: keycloak.org/v1alpha1
kind: KeycloakClient
metadata:
  name: openshift-client
  namespace: rhsso
spec:
  realmSelector:
    matchLabels:
      app: sso
  client:
    clientId: openshift-cluster
    name: OpenShift Cluster
    description: "OpenShift OAuth Integration"
    enabled: true
    clientAuthenticatorType: client-secret
    secret: openshift-client-secret
    redirectUris:
    - "${OAUTH_CALLBACK}"
    webOrigins:
    - "/*"
    standardFlowEnabled: true
    implicitFlowEnabled: false
    directAccessGrantsEnabled: true
    protocol: openid-connect
    fullScopeAllowed: true
    protocolMappers:
    - name: groups
      protocol: openid-connect
      protocolMapper: oidc-group-membership-mapper
      config:
        "full.path": "false"
        "id.token.claim": "true"
        "access.token.claim": "true"
        "claim.name": "groups"
        "userinfo.token.claim": "true"
EOF
----

**The groups protocol mapper is critical** - it adds group membership to the ID token, enabling automatic group sync in OpenShift.

**Verify client created:**

[source,bash,role="execute"]
----
oc get keycloakclient -n rhsso
----

**Note the client secret:**

The client secret has been set to `openshift-client-secret` in the KeycloakClient configuration above. You'll use this value in Step 7 for OpenShift OAuth configuration.

In production environments, you would retrieve the auto-generated secret from Keycloak's admin console or API.

== Step 6: Create Groups in Keycloak and Complete OIDC Setup

Due to operator limitations with the KeycloakRealm, KeycloakUser, and KeycloakClient CRDs, we'll use the Keycloak REST API to complete the configuration.

**Option A: Automated setup script (recommended for lab environment):**

[source,bash,role="execute"]
----
bash /showroom/repo/.workshop/setup-keycloak-oidc.sh
----

This script creates:
- OpenShift realm in Keycloak
- Three users: admin1, developer1, viewer1 (password: OpenShift123!)
- Three groups: ocp-admins, ocp-developers, ocp-viewers
- OIDC client with groups protocol mapper
- User-to-group assignments

.Option B: Manual setup via Keycloak admin console (click to expand)
[%collapsible]
====
If you prefer to use the web console instead of the script:

1. Get the admin credentials:
+
[source,bash,role="execute"]
----
oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_USERNAME}' | base64 -d && echo
oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_PASSWORD}' | base64 -d && echo
----

2. Get the Keycloak URL:
+
[source,bash,role="execute"]
----
oc get route keycloak -n rhsso -o jsonpath='{.spec.host}' && echo
----

3. Open browser to: `https://<keycloak-route>/auth/admin`
4. Login with admin credentials
5. Create the **openshift** realm
6. Create users: admin1, developer1, viewer1
7. Create groups: ocp-admins, ocp-developers, ocp-viewers
8. Assign users to their respective groups
9. Create OIDC client `openshift-cluster` with groups protocol mapper
====

**Production Note:** In production environments, you would integrate Keycloak with your organization's existing LDAP/Active Directory rather than creating users manually.

== Step 7: Configure OpenShift OAuth with OIDC

**Create secret with OIDC client credentials:**

[source,bash,role="execute"]
----
oc create secret generic rhsso-client-secret \
  --from-literal=clientSecret='openshift-client-secret' \
  -n openshift-config
----

**Configure OAuth to use Red Hat SSO:**

[source,bash,role="execute"]
----
KEYCLOAK_URL=$(oc get route keycloak -n rhsso -o jsonpath='{.spec.host}')

cat <<EOF | oc apply -f -
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: rhsso
    mappingMethod: claim
    type: OpenID
    openID:
      clientID: openshift-cluster
      clientSecret:
        name: rhsso-client-secret
      issuer: https://${KEYCLOAK_URL}/auth/realms/openshift
      claims:
        preferredUsername:
        - preferred_username
        name:
        - name
        email:
        - email
        groups:
        - groups
      extraScopes:
      - email
      - profile
EOF
----

**Key configuration:**
- `claims.groups: [groups]` - Maps the `groups` claim from Keycloak to OpenShift groups
- `mappingMethod: claim` - First login wins the username
- `issuer` - Keycloak realm endpoint

**Monitor OAuth operator rollout:**

[source,bash,role="execute"]
----
oc rollout status deployment/oauth-openshift -n openshift-authentication
----

Wait for: `deployment "oauth-openshift" successfully rolled out`

**Verify OAuth pods restarted:**

[source,bash,role="execute"]
----
oc get pods -n openshift-authentication
----

All oauth-openshift pods should be `Running` and `Ready 1/1`.

== Step 8: Test OIDC Authentication

OIDC uses the **authorization code flow** which requires a web browser for authentication. Unlike LDAP, you cannot use `oc login -u username -p password` directly with OIDC.

**Understanding OIDC Login Flow:**

1. User initiates login to OpenShift
2. OpenShift redirects to Keycloak login page
3. User authenticates with Keycloak
4. Keycloak redirects back to OpenShift with authorization code
5. OpenShift exchanges code for access token
6. User is logged in with groups from ID token claims

**Test OIDC authentication via web console (recommended):**

1. Get the console URL:
+
[source,bash,role="execute"]
----
oc whoami --show-console
----

2. Open the URL in a web browser
3. If you're already logged in from previous modules, click on your username in the top-right corner and select **Log out**
4. You'll see two login options:
+
image::oidc-login-options.png[OpenShift login page showing kube:admin and rhsso options]
+
   - **kube:admin** (local admin account)
   - **rhsso** (OIDC provider)
5. Click **rhsso**
6. You'll be redirected to Keycloak
7. Log in with: `developer1` / `OpenShift123!`
8. You'll be redirected back to OpenShift console
9. You're now logged in via OIDC!

**Verify the login worked:**

After logging in via web console, click on your username in the top-right corner and select "Copy login command". This will give you a token you can use with the CLI.

**Alternative: CLI login with browser (oc login without credentials):**

[source,bash,role="execute"]
----
oc login --server=$(oc whoami --show-server) --insecure-skip-tls-verify
----

This will print a URL. Open it in your browser, select **rhsso**, authenticate, and copy the provided login command.

**Verify from cluster admin perspective:**

If you tested the OIDC login via CLI, you're now logged in as developer1. Switch back to the service account to run admin commands:

[source,bash,role="execute"]
----
oc logout
----

The terminal will automatically use the service account with cluster-admin permissions. Now verify the users:

[source,bash,role="execute"]
----
oc get users
----

You should see the OIDC users who have logged in:

```
NAME         UID                                    FULL NAME         IDENTITIES
developer1   <uuid>                                 Developer User    rhsso:<uuid>
```

**Check user details:**

[source,bash,role="execute"]
----
oc get user developer1 -o yaml
----

Notice the identity provider is `rhsso`.

== Step 9: Verify Automatic Group Synchronization

This is where OIDC shines - groups automatically sync from token claims without manual commands!

**View automatically created groups:**

[source,bash,role="execute"]
----
oc get groups
----

You should see:

```
NAME             USERS
ocp-admins       admin1
ocp-developers   developer1
ocp-viewers      viewer1
```

**These groups were created automatically** when users logged in! Compare this to LDAP:

**LDAP (Manual Sync):**
```bash
# Required manual command:
oc adm groups sync --sync-config=groupsync.yaml --confirm
```

**OIDC (Automatic):**
```
Groups sync automatically from ID token on every login
No manual sync required!
```

**Examine a group:**

[source,bash,role="execute"]
----
oc get group ocp-developers -o yaml
----

Notice:
- No LDAP metadata (this came from OIDC)
- Users automatically added based on token claims
- Group was created automatically

== Step 10: Configure RBAC with OIDC Groups

**Grant cluster-admin to ocp-admins group:**

[source,bash,role="execute"]
----
oc adm policy add-cluster-role-to-group cluster-admin ocp-admins
----

**Grant cluster-reader to ocp-viewers group:**

[source,bash,role="execute"]
----
oc adm policy add-cluster-role-to-group cluster-reader ocp-viewers
----

**Create projects for developers:**

[source,bash,role="execute"]
----
oc adm new-project app-development --display-name="Application Development"
oc adm new-project app-staging --display-name="Application Staging"
oc adm new-project app-production --display-name="Application Production"
----

**Grant developers edit access to dev and staging:**

[source,bash,role="execute"]
----
oc adm policy add-role-to-group edit ocp-developers -n app-development
oc adm policy add-role-to-group edit ocp-developers -n app-staging
----

**Grant developers view access to production:**

[source,bash,role="execute"]
----
oc adm policy add-role-to-group view ocp-developers -n app-production
----

== Step 11: Test OIDC-Based RBAC

To test RBAC with OIDC users, you need to:
1. Log in via web console as the OIDC user (rhsso login option)
2. Copy the login command from the console
3. Use that token-based login command in your terminal

**Test as admin1 (should have cluster-admin):**

1. Log in to web console as `admin1` / `OpenShift123!` (via rhsso)
2. Copy login command from console (top-right menu)
3. Run the command in terminal
4. Test permissions:

[source,bash,role="copypaste"]
----
oc auth can-i '*' '*'
----

Output: `yes` (cluster-admin role)

**Test as viewer1 (should see all projects, read-only):**

1. Log in to web console as `viewer1` / `OpenShift123!` (via rhsso)
2. Click your username (top-right) → **Copy login command** → **Display Token**
3. Copy and paste the `oc login --token=...` command into your terminal
4. Test permissions:

[source,bash,role="copypaste"]
----
oc get projects
----

This lists all projects - viewer1 can see everything cluster-wide.

[source,bash,role="copypaste"]
----
oc auth can-i create deployment -n default
----

This checks if viewer1 can create deployments - returns `no` (cluster-reader is view-only).

**Test as developer1:**

1. Log in to web console as `developer1` / `OpenShift123!` (via rhsso)
2. Click your username (top-right) → **Copy login command** → **Display Token**
3. Copy and paste the `oc login --token=...` command into your terminal
4. Check accessible projects:

[source,bash,role="copypaste"]
----
oc get projects
----

You should see:

```
NAME               DISPLAY NAME            STATUS
app-development    Application Development Active
app-production     Application Production  Active
app-staging        Application Staging     Active
```

**Verify developer can edit in development:**

[source,bash,role="copypaste"]
----
oc auth can-i create deployment -n app-development
oc auth can-i create pod -n app-development
----

Both return: `yes` (edit role)

**Verify developer is view-only in production:**

[source,bash,role="copypaste"]
----
oc auth can-i create deployment -n app-production
oc auth can-i get pods -n app-production
----

First returns: `no`, second returns: `yes` (view role)

**Perfect!** OIDC groups automatically control RBAC.

**Log back in as cluster admin:**

[source,bash,role="execute"]
----
oc login -u kubeadmin -p {kubeadmin_password}
----

== Step 12: Test Group Updates (Automatic Sync)

Let's demonstrate how OIDC groups update automatically when membership changes in Keycloak.

**Add developer1 to ocp-admins group in Keycloak:**

Option A: Use the Keycloak admin console:
1. Access Keycloak admin console (get URL from Step 6)
2. Navigate to **openshift** realm
3. **Users** → **developer1** → **Groups** tab
4. Select `ocp-admins` from Available Groups
5. Click **Join**

Option B: Use the Keycloak API:

[source,bash,role="copypaste"]
----
# Get group and user IDs, then add user to group
KEYCLOAK_URL=$(oc get route keycloak -n rhsso -o jsonpath='{.spec.host}')
ADMIN_USER=$(oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_USERNAME}' | base64 -d)
ADMIN_PASS=$(oc get secret credential-rhsso -n rhsso -o jsonpath='{.data.ADMIN_PASSWORD}' | base64 -d)

TOKEN=$(curl -sk -X POST "https://${KEYCLOAK_URL}/auth/realms/master/protocol/openid-connect/token" \
  -d "username=$ADMIN_USER" \
  -d "password=$ADMIN_PASS" \
  -d 'grant_type=password' \
  -d 'client_id=admin-cli' | python3 -c "import sys, json; print(json.load(sys.stdin)['access_token'])")

ADMINS_ID=$(curl -sk "https://${KEYCLOAK_URL}/auth/admin/realms/openshift/groups" \
  -H "Authorization: Bearer $TOKEN" | python3 -c "import sys, json; print([g['id'] for g in json.load(sys.stdin) if g['name']=='ocp-admins'][0])")

DEV1_ID=$(curl -sk "https://${KEYCLOAK_URL}/auth/admin/realms/openshift/users?username=developer1" \
  -H "Authorization: Bearer $TOKEN" | python3 -c "import sys, json; print(json.load(sys.stdin)[0]['id'])")

curl -sk -X PUT "https://${KEYCLOAK_URL}/auth/admin/realms/openshift/users/${DEV1_ID}/groups/${ADMINS_ID}" \
  -H "Authorization: Bearer $TOKEN"

echo "developer1 added to ocp-admins group"
----

**Log out and back in as developer1:**

1. Log out from web console
2. Log back in via web console as `developer1` (rhsso option)
3. Copy new login command from console

**Check group membership as cluster admin:**

[source,bash,role="execute"]
----
oc login -u kubeadmin -p {kubeadmin_password}
oc get group ocp-admins -o yaml
oc get group ocp-developers -o yaml
----

You should now see `developer1` in **both** groups!

**Verify developer1 now has cluster-admin:**

After logging in as developer1 via web console with the new login command:

[source,bash,role="copypaste"]
----
oc auth can-i '*' '*'
----

Output: `yes` (inherited cluster-admin from ocp-admins group)

**This demonstrates automatic group sync** - no manual `oc adm groups sync` command required!

== Step 13: Web Console OIDC Login

**Access the OpenShift web console:**

1. Get console URL: `oc whoami --show-console`
2. Open in browser
3. You should see login page with two options:
   - **kubeadmin**
   - **rhsso** ← New OIDC option

4. Click **rhsso**
5. You'll be redirected to Keycloak login
6. Log in as `developer1` / `OpenShift123!`
7. You're redirected back to OpenShift console
8. You're now logged in via OIDC!

**Console features with OIDC:**
- Single sign-on across applications
- Session managed by Keycloak
- Automatic logout when Keycloak session expires
- Can enable MFA in Keycloak for additional security

== Comparison: LDAP vs OIDC

Based on completing both modules, here's the comparison:

[cols="1,1,1"]
|===
|Aspect |LDAP Module |OIDC Module (This Lab)

|Group sync
|Manual: `oc adm groups sync`
|**Automatic** from token claims

|Sync frequency
|CronJob or manual
|**Every login** (real-time)

|User creation
|On first login
|On first login (same)

|Group management
|In LDAP server + OpenShift
|**Centralized** in Keycloak

|Token lifetime
|Session-based
|Configurable (default 24h)

|Modern auth (MFA)
|Additional integration needed
|**Native** Keycloak support

|Multi-app SSO
|Limited
|**Yes** - one login for all apps

|Setup complexity
|Certificates, bind DN
|Client registration

|Best for
|On-premises AD/LDAP
|**Cloud-native, modern auth**
|===

**Key takeaway:** OIDC provides automatic group synchronization and modern authentication features ideal for cloud-native environments.

== Production Considerations

**For production OIDC integration:**

1. **Use external identity provider:**
   - Azure AD (Microsoft Entra ID)
   - Okta
   - Google Workspace
   - Enterprise Keycloak cluster

2. **Enable high availability:**
   - Deploy Keycloak with multiple replicas
   - Use external database (PostgreSQL)
   - Configure session replication

3. **Security best practices:**
   - Enable MFA in identity provider
   - Configure token expiration policies
   - Use certificate validation (not `insecure: true`)
   - Rotate client secrets regularly

4. **Monitoring:**
   - Monitor OAuth pod health
   - Track authentication failures
   - Alert on provider availability issues

5. **Group management:**
   - Use consistent group naming conventions
   - Document group-to-role mappings
   - Regular access reviews in identity provider

== Troubleshooting

**Issue: Users not appearing in groups**

Check if groups claim is in the ID token:

[source,bash,role="execute"]
----
oc get user developer1 -o yaml
----

Verify the Keycloak client has the groups protocol mapper configured (Step 5).

**Issue: Redirect loop when logging in**

[source,bash,role="execute"]
----
oc get oauth cluster -o yaml
----

Verify:
- `issuer` URL matches Keycloak route
- `clientID` matches `openshift-cluster`
- Redirect URI in Keycloak client matches OpenShift OAuth callback

**Issue: OAuth pods not restarting**

[source,bash,role="execute"]
----
oc get clusteroperator authentication
oc describe clusteroperator authentication
----

Force rollout if needed:

[source,bash,role="execute"]
----
oc rollout restart deployment/oauth-openshift -n openshift-authentication
----

**Issue: Keycloak not accessible**

[source,bash,role="execute"]
----
oc get pods -n rhsso
oc logs -n rhsso -l app=keycloak
oc get routes -n rhsso
----

== Summary

**What you configured:**

✅ **Red Hat SSO Deployment** - Installed and configured Keycloak using Operators +
✅ **OIDC Realm & Client** - Created OpenShift integration with group claims +
✅ **Automatic Group Sync** - Groups sync from ID token without manual commands +
✅ **RBAC with OIDC** - Configured cluster and project-level permissions +
✅ **Web Console SSO** - Tested browser-based OIDC authentication +
✅ **Dynamic Updates** - Demonstrated real-time group membership changes

**Key takeaways:**

* **OIDC groups sync automatically** - No `oc adm groups sync` required (unlike LDAP)
* **Token-based authentication** - Modern, cloud-native approach
* **Red Hat SSO (Keycloak)** - Official Red Hat product for enterprise SSO
* **Operator-based deployment** - Kubernetes-native management
* **Real-time updates** - Group membership changes take effect on next login
* **Production-ready** - Same approach for Azure AD, Okta, Google Workspace

**OIDC vs LDAP:**
- **OIDC:** Automatic group sync, modern auth, cloud-native, better for SaaS/cloud environments
- **LDAP:** Manual group sync, traditional auth, on-premises, better for existing AD infrastructure

Both methods are valid - choose based on your organization's existing identity infrastructure.

== Additional Resources

* **OpenID Connect Configuration:** link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/authentication_and_authorization/configuring-oidc-identity-provider[Configuring an OpenID Connect identity provider]
* **Red Hat SSO:** link:https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/[Red Hat Single Sign-On Documentation]
* **Keycloak Operator:** link:https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html/server_installation_and_configuration_guide/operator[Red Hat SSO Operator Guide]
* **RBAC Documentation:** link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/authentication_and_authorization/using-rbac[Using RBAC]
* **Identity Providers Overview:** link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html/authentication_and_authorization/understanding-identity-provider[Understanding identity providers]

---

**Log back in as cluster admin:**

[source,bash,role="execute"]
----
oc login -u kubeadmin -p {kubeadmin_password}
----

**Next Module:** Continue with xref:app-mgmt-basics.adoc[Application Management Basics] to learn about deploying applications.
