= Platform Engineering - Red Hat Developer Hub

== Module Overview

**Duration:** 20-25 minutes +
**Format:** Dashboard exploration + Demo +
**Audience:** IT Operations, Platform Engineers, Infrastructure Architects

**Workshop Narrative Context:**

We've learned how to:
- Secure workloads with RHACS
- Enforce governance policies
- Monitor compliance

**Now:** How do we **enable developer self-service** while maintaining operational control? How do we reduce repetitive requests and tickets?

== Learning Objectives

By the end of this module, you will be able to:

* Understand what Red Hat Developer Hub (RHDH) is and how it fits into platform operations
* Access the Developer Hub portal
* Explore the software catalog
* See how software templates provide "golden paths"
* Understand how RHDH reduces operational toil

== What is Red Hat Developer Hub?

**Red Hat Developer Hub (RHDH)** is an **enterprise-grade Internal Developer Platform** based on Backstage.

Think of it as: **Your organization's developer self-service portal**

=== The Operations Problem It Solves

**Before RHDH:**

* Developers submit tickets: "Create me a new app with CI/CD"
* Ops manually provisions: namespace, RBAC, quotas, pipeline, git repo
* Process takes days or weeks
* Inconsistent configurations
* Documentation scattered everywhere

**With RHDH:**

* Developer clicks "Create New App" in portal
* Template automatically provisions: namespace, RBAC, quotas, pipeline, git repo
* Process takes minutes
* **Ops-defined golden paths** ensure consistency
* Self-service with governance built-in

=== Key Capabilities

* **Software Catalog** - Unified view of all services, APIs, libraries
* **Software Templates** - Self-service app creation with Ops-approved patterns
* **TechDocs** - Documentation integrated with code
* **Plugins** - Integrate with tools (ArgoCD, Tekton, Jira, etc.)
* **RBAC** - Fine-grained access control
* **API Integration** - Connect to existing systems

== RHDH Architecture (Quick Overview)

RHDH on OpenShift consists of:

* **Backstage Frontend** - Web portal UI
* **Backstage Backend** - API and orchestration layer
* **PostgreSQL Database** - Stores catalog and configuration
* **Plugins** - Extend functionality (Kubernetes, Tekton, ArgoCD, etc.)

All of this was deployed via the **Red Hat Developer Hub Operator** from the Software Catalog.

== Hands-On: Accessing Developer Hub

=== Step 1: Verify RHDH is Running

Check the RHDH pods:

[source,bash,role="execute"]
----
oc get pods -n backstage
----

You should see:

----
NAME                                       READY   STATUS
backstage-developer-hub-xxxxx              1/1     Running
backstage-psql-developer-hub-0             1/1     Running
----

Check the deployment details:

[source,bash,role="execute"]
----
oc get deployment -n backstage
----

View the Backstage container resources:

[source,bash,role="execute"]
----
oc get deployment backstage-developer-hub -n backstage -o jsonpath='{.spec.template.spec.containers[0].resources}' | python3 -m json.tool
----

=== Step 2: Get the Developer Hub URL

Get the Developer Hub portal URL:

[source,bash,role="execute"]
----
oc get route backstage-developer-hub -n backstage -o jsonpath='https://{.spec.host}'
----

Output:

----
https://backstage-developer-hub-backstage.apps.cluster-GUID.example.com
----

View all routes in the backstage namespace:

[source,bash,role="execute"]
----
oc get routes -n backstage
----

=== Step 3: Access the Portal

1. **Open the Developer Hub URL** in a new browser tab
2. You'll see the **Red Hat Developer Hub** login page
3. Select **Guest** to enter without authentication, or use another sign-in method if configured

image::rhdh-login-page.png[Developer Hub login page]

Click **Enter** under Guest to access the portal.

You're now in the **Developer Hub Portal**.

image::rhdh-home-page.png[Developer Hub home page]

The home page shows:

* **Get started** - Links to documentation
* **Explore** - Navigate to the Catalog, APIs, and templates
* **Learn** - Learning paths and tutorials
* **Quickstart guide** (right panel) - Steps for authentication, RBAC, Git, and plugins

== Ops Admin: Exploring RHDH from the Console and CLI

As an operations administrator, you'll want to understand how RHDH is deployed and configured. Let's explore.

=== View RHDH in the OpenShift Console

1. In the OpenShift console, go to **Workloads** -> **Pods**
2. Select the **backstage** project from the project dropdown
3. You'll see the `backstage-developer-hub` and `backstage-psql-developer-hub` pods running

image::rhdh-pods-running.png[Backstage pods running in the console]

Click on a pod to see:

* Pod details and status
* Resource usage (CPU/Memory)
* Environment variables
* Mounted ConfigMaps and Secrets

=== Explore the Operator

The RHDH Operator manages the Backstage instance:

1. Go to **Operators** -> **Installed Operators**
2. Select **All Projects** or **backstage**
3. Click on **Red Hat Developer Hub**
4. Under **Provided APIs**, you'll see the `Backstage` custom resource

image::rhdh-operator-installed.png[Red Hat Developer Hub Operator installed]

Click on the **Red Hat Developer Hub** tab to see the Backstage instances:

image::rhdh-backstage-cr.png[Backstage CR showing deployed status]

View the Backstage CR via CLI:

[source,bash,role="execute"]
----
oc get backstage -n backstage
----

Get detailed status:

[source,bash,role="execute"]
----
oc describe backstage developer-hub -n backstage
----

=== View Configuration

RHDH configuration is stored in ConfigMaps. List them:

[source,bash,role="execute"]
----
oc get configmaps -n backstage
----

View the main app configuration:

[source,bash,role="execute"]
----
oc get configmap backstage-developer-hub-app-config -n backstage -o yaml
----

=== Check Secrets

RHDH uses secrets for sensitive configuration (database credentials, OAuth, etc.):

[source,bash,role="execute"]
----
oc get secrets -n backstage
----

View the PostgreSQL secret (credentials):

[source,bash,role="execute"]
----
oc get secret backstage-psql-developer-hub -n backstage -o jsonpath='{.data}' | python3 -m json.tool
----

[NOTE]
====
Secret values are base64 encoded. You can decode them with `echo <value> | base64 -d`.
====

=== View Pod Logs

Check the Backstage application logs:

[source,bash,role="execute"]
----
oc logs -n backstage -l rhdh.redhat.com/app=backstage-developer-hub --tail=50
----

Check PostgreSQL database logs:

[source,bash,role="execute"]
----
oc logs -n backstage -l rhdh.redhat.com/app=backstage-psql-developer-hub --tail=20
----

=== Check Resource Usage

View current resource consumption:

[source,bash,role="execute"]
----
oc adm top pods -n backstage
----

=== View Services and Networking

Check the services exposed:

[source,bash,role="execute"]
----
oc get svc -n backstage
----

Check the route configuration:

[source,bash,role="execute"]
----
oc get route backstage-developer-hub -n backstage -o yaml | grep -A 10 "spec:"
----

=== Persistent Storage

RHDH uses PostgreSQL for persistence. Check the PVC:

[source,bash,role="execute"]
----
oc get pvc -n backstage
----

View storage details:

[source,bash,role="execute"]
----
oc describe pvc -n backstage
----

== The Developer Hub Portal: First Look

When you access Developer Hub, you see:

* **Software Catalog** - All registered apps, services, APIs
* **Create** - Software templates for new projects
* **Docs** - TechDocs documentation
* **APIs** - API catalog
* **Search** - Find anything across the catalog

**Key Concept:** This is a **developer-facing portal**, but **Ops defines the guardrails**.

== Exploring the Software Catalog

The catalog is the heart of Developer Hub.

image::rhdh-catalog-populated.png[Software Catalog with components]

The catalog shows all registered components with filters for Kind, Owner, Type, Lifecycle, and more. Each entry shows key metadata at a glance - owner, type, lifecycle stage, and description.

Click on a component to see its details:

image::rhdh-component-details.png[Component details page]

The component details page shows:

* **Overview** - Description, owner, lifecycle, system
* **Links** - Website, documentation, source code, chat
* **Dependencies** - What this component depends on
* **Docs** - TechDocs rendered from the repository

=== What Goes in the Catalog?

* **Components** - Applications, microservices
* **APIs** - REST APIs, GraphQL, gRPC
* **Resources** - Databases, message queues, storage
* **Systems** - Logical groupings of components
* **Domains** - Business domains

=== How Does Content Get Here?

1. **Catalog YAML files** - Stored in Git repositories
2. **Discovery** - RHDH scans repos for `catalog-info.yaml` files
3. **Registration** - Ops can manually register systems
4. **Plugins** - Auto-import from Kubernetes, ArgoCD, etc.

Example `catalog-info.yaml`:

[source,yaml]
----
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: mapit
  description: Mapping application for city data
  annotations:
    backstage.io/kubernetes-namespace: ops-track-demo
spec:
  type: service
  lifecycle: production
  owner: team-operations
  system: geospatial-services
----

== Software Templates: Golden Paths

**The Ops Superpower:** Software Templates let you define **how apps should be created**.

=== What's a Golden Path?

A **golden path** is a pre-approved, ops-blessed way to do something.

**Example Golden Path Template:**

* Create Git repo
* Generate app scaffold (language-specific)
* Create OpenShift namespace with quotas
* Apply RBAC (developer access, not cluster-admin)
* Set up Tekton pipeline
* Configure ArgoCD for GitOps
* Add monitoring/alerting
* Register in service catalog

**Developer Experience:**

1. Click "Create" in portal
2. Choose template: "Spring Boot Microservice"
3. Fill form: app name, team, database type
4. Click "Create"
5. Everything provisioned in 2 minutes

**Ops Experience:**

* Template defined once
* Consistent across all teams
* Security/compliance baked in
* No manual tickets
* Standardized observability

=== Template Benefits for Ops

[cols="1,2"]
|===
|Ops Challenge |How Templates Help

|**Inconsistent configurations**
|Every app follows same pattern

|**Manual provisioning tickets**
|Self-service reduces toil

|**Security misconfigurations**
|Security built into template

|**Quota violations**
|Templates enforce resource limits

|**Missing monitoring**
|Templates add Prometheus annotations

|**Documentation drift**
|TechDocs generated from template
|===

== Integration with OpenShift

RHDH integrates deeply with OpenShift:

=== Kubernetes Plugin

View OpenShift resources directly in the portal:

1. Navigate to a component in the catalog
2. Click the **Kubernetes** tab
3. See:
   * Pods status
   * Deployments
   * Services
   * Routes
   * Resource usage

**Use Case:** Developer checks their app status without needing `oc` CLI access.

=== Tekton Plugin

View CI/CD pipelines:

1. Navigate to a component
2. Click the **CI/CD** tab
3. See:
   * Pipeline runs
   * Build status
   * Logs

**Use Case:** Developer troubleshoots failed builds without accessing Tekton directly.

=== ArgoCD Plugin

View GitOps deployments:

1. Navigate to a component
2. Click the **ArgoCD** tab
3. See:
   * Sync status
   * Deployment history
   * Application health

**Use Case:** Developer sees deployment status, Ops controls ArgoCD access.

== RBAC and Access Control

**Critical for Ops:** RHDH has fine-grained RBAC.

=== Example Policies

[source,yaml]
----
# Developers can:
- Read catalog
- Create apps from templates
- View their namespace resources
- Trigger pipelines for their apps

# Developers CANNOT:
- Delete catalog entries
- Modify templates
- Access other team namespaces
- Change RBAC policies
----

**This is configured via:**

* **RHDH RBAC plugin**
* **OpenShift OAuth integration**
* **Permission policies** (defined by Ops)

Command to check RBAC configuration:

[source,bash,role="execute"]
----
oc get configmap -n backstage | grep rbac
----

== TechDocs: Documentation as Code

RHDH supports **TechDocs** - documentation that lives with code.

=== How It Works

1. Write docs in Markdown in your Git repo (e.g., `docs/index.md`)
2. RHDH builds and renders them
3. Documentation shows up in the portal under your component

**Benefits for Ops:**

* No separate wiki to maintain
* Docs versioned with code
* Searchable across all services
* Always up-to-date

Example structure:

----
my-app/
├── catalog-info.yaml
├── docs/
│   ├── index.md          # Overview
│   ├── architecture.md   # Architecture
│   └── operations.md     # Runbooks
└── src/
----

When developers view `my-app` in the catalog, they see these docs rendered beautifully.

== Ops Workflow: Creating a Template

Here's how Ops would create a new golden path template:

=== Step 1: Define Template YAML

Create `template.yaml`:

[source,yaml]
----
apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: openshift-app-template
  title: OpenShift Application
  description: Create a new app with namespace, pipeline, and GitOps
spec:
  owner: platform-team
  type: service
  parameters:
    - title: Application Details
      required:
        - name
        - owner
      properties:
        name:
          title: Name
          type: string
        owner:
          title: Team
          type: string
  steps:
    - id: create-namespace
      name: Create OpenShift Namespace
      action: kubernetes:create-namespace
      input:
        name: ${{ parameters.name }}
        labels:
          owner: ${{ parameters.owner }}

    - id: apply-quotas
      name: Apply Resource Quotas
      action: kubernetes:apply
      input:
        manifest: |
          apiVersion: v1
          kind: ResourceQuota
          metadata:
            name: default-quota
            namespace: ${{ parameters.name }}
          spec:
            hard:
              requests.cpu: "4"
              requests.memory: 8Gi

    - id: create-pipeline
      name: Create Tekton Pipeline
      action: tekton:create-pipeline
      # ... pipeline definition

    - id: register-catalog
      name: Register in Catalog
      action: catalog:register
      # ... catalog registration
----

=== Step 2: Store in Git

[source,bash,role="copypaste"]
----
# Store template in Git repo
git clone https://github.com/your-org/rhdh-templates.git
cd rhdh-templates
mkdir openshift-app
cp template.yaml openshift-app/
git add .
git commit -m "Add OpenShift app template"
git push
----

=== Step 3: Register Template in RHDH

Point RHDH at your templates repo:

[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
  namespace: backstage
data:
  app-config.yaml: |
    catalog:
      locations:
        - type: url
          target: https://github.com/your-org/rhdh-templates/blob/main/catalog-info.yaml
----

Apply and reload:

[source,bash,role="copypaste"]
----
oc apply -f app-config.yaml
oc rollout restart deployment/backstage-developer-hub -n backstage
----

**Result:** Template now appears in "Create" menu for developers.

== Troubleshooting RHDH

Common issues and how to diagnose them:

=== Check Pod Status

[source,bash,role="execute"]
----
oc get pods -n backstage
----

If pods are not running, check events:

[source,bash,role="execute"]
----
oc get events -n backstage --sort-by='.lastTimestamp' | tail -20
----

=== Check Application Health

View the Backstage health endpoint:

[source,bash,role="execute"]
----
curl -sk $(oc get route backstage-developer-hub -n backstage -o jsonpath='https://{.spec.host}')/.backstage/health/v1/readiness
----

You should see `{"status":"ok"}` if RHDH is healthy.

=== Database Connectivity

If you see database connection errors in logs, check PostgreSQL:

[source,bash,role="execute"]
----
oc exec -n backstage backstage-psql-developer-hub-0 -- psql -U postgres -c "SELECT 1"
----

=== Restart the Deployment

If RHDH is misbehaving after config changes:

[source,bash,role="copypaste"]
----
oc rollout restart deployment/backstage-developer-hub -n backstage
----

Watch the rollout:

[source,bash,role="execute"]
----
oc rollout status deployment/backstage-developer-hub -n backstage
----

=== View Operator Logs

If the Backstage CR is not reconciling properly:

[source,bash,role="execute"]
----
oc logs -n rhdh-operator -l app=rhdh-operator --tail=50
----

== CLI Access (For Automation)

RHDH has a REST API for automation:

[source,bash,role="copypaste"]
----
# Example: Get all catalog components
curl -H "Authorization: Bearer $TOKEN" \
  https://backstage-developer-hub-rhdh.apps.cluster.com/api/catalog/entities

# Example: Trigger template scaffolding
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  https://backstage-developer-hub-rhdh.apps.cluster.com/api/scaffolder/v2/tasks \
  -d '{
    "templateRef": "template:default/openshift-app-template",
    "values": {
      "name": "my-new-app",
      "owner": "team-a"
    }
  }'
----

This enables **infrastructure-as-code** provisioning via CI/CD.

== Summary: How RHDH Fits into Ops Workflow

[cols="1,2"]
|===
|Ops Activity |How RHDH Helps

|**Developer requests new app**
|Self-service via templates, no manual provisioning

|**Onboarding new team**
|Portal provides discoverability, no scattered docs

|**Enforcing standards**
|Templates bake in security, quotas, monitoring

|**Tracking all services**
|Catalog provides single source of truth

|**Compliance auditing**
|See which apps follow which patterns

|**Reducing toil**
|Automation via templates and plugins
|===

**Key operational commands:**

[source,bash]
----
# View RHDH pods
oc get pods -n backstage

# Check Backstage CR status
oc get backstage -n backstage

# View application logs
oc logs -n backstage -l rhdh.redhat.com/app=backstage-developer-hub --tail=50

# View configuration
oc get configmaps -n backstage

# Restart after config changes
oc rollout restart deployment/backstage-developer-hub -n backstage
----

== Key Takeaways

* **Self-Service** - Developers provision apps without tickets
* **Governance** - Ops defines templates with security baked in
* **Standardization** - Golden paths ensure consistency
* **Integration** - Works with OpenShift, Tekton, ArgoCD, RHACS
* **Visibility** - Catalog shows everything in one place
* **Reduced Toil** - Automation eliminates manual provisioning

== The "Tee-Up" for Platform Engineering Workshops

This module showed you **basic Developer Hub capabilities**.

**RHDH can do much more:**
- Advanced software templates with multi-step workflows
- Custom plugins development
- API catalog and governance
- Cost tracking and showback
- Integration with external systems (Jira, ServiceNow, GitHub, GitLab)
- Organization structure modeling
- Scaffolder actions for complex provisioning

**Interested in a deep-dive?** Ask your instructor about the **Platform Engineering with RHDH Workshop**.

== Next Module

Continue to **Debugging & Troubleshooting** to learn how to diagnose and fix common OpenShift issues.

---

**Questions?** Discuss platform engineering strategies with your instructor.
